{"ast":null,"code":"var _jsxFileName = \"C:\\\\blockchain\\\\Victus-health-assistant-main\\\\Victus-health-assistant-main\\\\src\\\\pages\\\\home.jsx\";\nimport DStorage from \"../abis/DStorage.json\";\nimport React, { Component } from \"react\";\nimport Main from \"../components/main\";\nimport Web3 from \"web3\";\nimport UserNavbar from \"../components/user-navbar/user-navbar\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ipfsClient = require(\"ipfs-http-client\");\nconst ipfs = ipfsClient({\n  host: \"ipfs.infura.io\",\n  port: 5001,\n  protocol: \"https\"\n}); // leaving out the arguments will default to these values\n\nclass Home extends Component {\n  async componentWillMount() {\n    await this.loadWeb3();\n    await this.loadBlockchainData();\n  }\n  async loadWeb3() {\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum);\n      await window.ethereum.enable();\n    } else if (window.web3) {\n      window.web3 = new Web3(window.web3.currentProvider);\n    } else {\n      window.alert(\"Non-Ethereum browser detected. You should consider trying MetaMask!\");\n    }\n  }\n  async loadBlockchainData() {\n    const web3 = window.web3;\n    // Load account\n    const accounts = await web3.eth.getAccounts();\n    this.setState({\n      account: accounts[0]\n    });\n    // Network ID\n    const networkId = await web3.eth.net.getId();\n    const networkData = DStorage.networks[networkId];\n    if (networkData) {\n      // Assign contract\n      const dstorage = new web3.eth.Contract(DStorage.abi, networkData.address);\n      this.setState({\n        dstorage\n      });\n      // Get files amount\n      const filesCount = await dstorage.methods.fileCount().call();\n      this.setState({\n        filesCount\n      });\n      // Load files&sort by the newest\n      for (var i = filesCount; i >= 1; i--) {\n        const file = await dstorage.methods.files(i).call();\n        this.setState({\n          files: [...this.state.files, file]\n        });\n      }\n    } else {\n      window.alert(\"DStorage contract not deployed to detected network.\");\n    }\n  }\n\n  // Get file from user\n\n  constructor(props) {\n    super(props);\n    this.captureFile = event => {\n      event.preventDefault();\n      const file = event.target.files[0];\n      const reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n      reader.onloadend = () => {\n        this.setState({\n          buffer: Buffer(reader.result),\n          type: file.type,\n          name: file.name\n        });\n        console.log(\"buffer\", this.state.buffer);\n      };\n    };\n    this.uploadFile = description => {\n      console.log(\"Submitting file to IPFS...\");\n\n      // Add file to the IPFS\n      ipfs.add(this.state.buffer, (error, result) => {\n        console.log(\"IPFS result\", result);\n        if (error) {\n          console.error(error);\n          return;\n        }\n        this.setState({\n          loading: true\n        });\n        // Assign value for the file without extension\n        if (this.state.type === \"\") {\n          this.setState({\n            type: \"none\"\n          });\n        }\n        this.state.dstorage.methods.uploadFile(result[0].hash, result[0].size, this.state.type, this.state.name, description).send({\n          from: this.state.account\n        }).on(\"transactionHash\", hash => {\n          this.setState({\n            loading: false,\n            type: null,\n            name: null\n          });\n          window.location.reload();\n        }).on(\"error\", e => {\n          window.alert(\"Error\");\n          this.setState({\n            loading: false\n          });\n        });\n      });\n    };\n    this.state = {\n      account: \"\",\n      dstorage: null,\n      files: [],\n      loading: false,\n      type: null,\n      name: null\n    };\n    this.uploadFile = this.uploadFile.bind(this);\n    this.captureFile = this.captureFile.bind(this);\n  }\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(UserNavbar, {\n        account: this.state.account\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, this), this.state.loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"loader\",\n        className: \"text-center mt-5\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(Main, {\n        files: this.state.files,\n        captureFile: this.captureFile,\n        uploadFile: this.uploadFile\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this);\n  }\n}\nexport default Home;","map":{"version":3,"names":["DStorage","React","Component","Main","Web3","UserNavbar","jsxDEV","_jsxDEV","ipfsClient","require","ipfs","host","port","protocol","Home","componentWillMount","loadWeb3","loadBlockchainData","window","ethereum","web3","enable","currentProvider","alert","accounts","eth","getAccounts","setState","account","networkId","net","getId","networkData","networks","dstorage","Contract","abi","address","filesCount","methods","fileCount","call","i","file","files","state","constructor","props","captureFile","event","preventDefault","target","reader","FileReader","readAsArrayBuffer","onloadend","buffer","Buffer","result","type","name","console","log","uploadFile","description","add","error","loading","hash","size","send","from","on","location","reload","e","bind","render","children","fileName","_jsxFileName","lineNumber","columnNumber","id","className"],"sources":["C:/blockchain/Victus-health-assistant-main/Victus-health-assistant-main/src/pages/home.jsx"],"sourcesContent":["import DStorage from \"../abis/DStorage.json\";\nimport React, { Component } from \"react\";\nimport Main from \"../components/main\";\nimport Web3 from \"web3\";\nimport UserNavbar from \"../components/user-navbar/user-navbar\";\n\nconst ipfsClient = require(\"ipfs-http-client\");\nconst ipfs = ipfsClient({\n  host: \"ipfs.infura.io\",\n  port: 5001,\n  protocol: \"https\",\n}); // leaving out the arguments will default to these values\n\nclass Home extends Component {\n  async componentWillMount() {\n    await this.loadWeb3();\n    await this.loadBlockchainData();\n  }\n\n  async loadWeb3() {\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum);\n      await window.ethereum.enable();\n    } else if (window.web3) {\n      window.web3 = new Web3(window.web3.currentProvider);\n    } else {\n      window.alert(\n        \"Non-Ethereum browser detected. You should consider trying MetaMask!\"\n      );\n    }\n  }\n\n  async loadBlockchainData() {\n    const web3 = window.web3;\n    // Load account\n    const accounts = await web3.eth.getAccounts();\n    this.setState({ account: accounts[0] });\n    // Network ID\n    const networkId = await web3.eth.net.getId();\n    const networkData = DStorage.networks[networkId];\n    if (networkData) {\n      // Assign contract\n      const dstorage = new web3.eth.Contract(DStorage.abi, networkData.address);\n      this.setState({ dstorage });\n      // Get files amount\n      const filesCount = await dstorage.methods.fileCount().call();\n      this.setState({ filesCount });\n      // Load files&sort by the newest\n      for (var i = filesCount; i >= 1; i--) {\n        const file = await dstorage.methods.files(i).call();\n        this.setState({\n          files: [...this.state.files, file],\n        });\n      }\n    } else {\n      window.alert(\"DStorage contract not deployed to detected network.\");\n    }\n  }\n\n  // Get file from user\n  captureFile = (event) => {\n    event.preventDefault();\n\n    const file = event.target.files[0];\n    const reader = new window.FileReader();\n\n    reader.readAsArrayBuffer(file);\n    reader.onloadend = () => {\n      this.setState({\n        buffer: Buffer(reader.result),\n        type: file.type,\n        name: file.name,\n      });\n      console.log(\"buffer\", this.state.buffer);\n    };\n  };\n\n  uploadFile = (description) => {\n    console.log(\"Submitting file to IPFS...\");\n\n    // Add file to the IPFS\n    ipfs.add(this.state.buffer, (error, result) => {\n      console.log(\"IPFS result\", result);\n      if (error) {\n        console.error(error);\n        return;\n      }\n\n      this.setState({ loading: true });\n      // Assign value for the file without extension\n      if (this.state.type === \"\") {\n        this.setState({ type: \"none\" });\n      }\n      this.state.dstorage.methods\n        .uploadFile(\n          result[0].hash,\n          result[0].size,\n          this.state.type,\n          this.state.name,\n          description\n        )\n        .send({ from: this.state.account })\n        .on(\"transactionHash\", (hash) => {\n          this.setState({\n            loading: false,\n            type: null,\n            name: null,\n          });\n          window.location.reload();\n        })\n        .on(\"error\", (e) => {\n          window.alert(\"Error\");\n          this.setState({ loading: false });\n        });\n    });\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      account: \"\",\n      dstorage: null,\n      files: [],\n      loading: false,\n      type: null,\n      name: null,\n    };\n    this.uploadFile = this.uploadFile.bind(this);\n    this.captureFile = this.captureFile.bind(this);\n  }\n\n  render() {\n    return (\n      <div>\n        <UserNavbar account={this.state.account} />\n        {this.state.loading ? (\n          <div id=\"loader\" className=\"text-center mt-5\">\n            <p>Loading...</p>\n          </div>\n        ) : (\n          <Main\n            files={this.state.files}\n            captureFile={this.captureFile}\n            uploadFile={this.uploadFile}\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nexport default Home;\n"],"mappings":";AAAA,OAAOA,QAAQ,MAAM,uBAAuB;AAC5C,OAAOC,KAAK,IAAIC,SAAS,QAAQ,OAAO;AACxC,OAAOC,IAAI,MAAM,oBAAoB;AACrC,OAAOC,IAAI,MAAM,MAAM;AACvB,OAAOC,UAAU,MAAM,uCAAuC;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE/D,MAAMC,UAAU,GAAGC,OAAO,CAAC,kBAAkB,CAAC;AAC9C,MAAMC,IAAI,GAAGF,UAAU,CAAC;EACtBG,IAAI,EAAE,gBAAgB;EACtBC,IAAI,EAAE,IAAI;EACVC,QAAQ,EAAE;AACZ,CAAC,CAAC,CAAC,CAAC;;AAEJ,MAAMC,IAAI,SAASZ,SAAS,CAAC;EAC3B,MAAMa,kBAAkBA,CAAA,EAAG;IACzB,MAAM,IAAI,CAACC,QAAQ,CAAC,CAAC;IACrB,MAAM,IAAI,CAACC,kBAAkB,CAAC,CAAC;EACjC;EAEA,MAAMD,QAAQA,CAAA,EAAG;IACf,IAAIE,MAAM,CAACC,QAAQ,EAAE;MACnBD,MAAM,CAACE,IAAI,GAAG,IAAIhB,IAAI,CAACc,MAAM,CAACC,QAAQ,CAAC;MACvC,MAAMD,MAAM,CAACC,QAAQ,CAACE,MAAM,CAAC,CAAC;IAChC,CAAC,MAAM,IAAIH,MAAM,CAACE,IAAI,EAAE;MACtBF,MAAM,CAACE,IAAI,GAAG,IAAIhB,IAAI,CAACc,MAAM,CAACE,IAAI,CAACE,eAAe,CAAC;IACrD,CAAC,MAAM;MACLJ,MAAM,CAACK,KAAK,CACV,qEACF,CAAC;IACH;EACF;EAEA,MAAMN,kBAAkBA,CAAA,EAAG;IACzB,MAAMG,IAAI,GAAGF,MAAM,CAACE,IAAI;IACxB;IACA,MAAMI,QAAQ,GAAG,MAAMJ,IAAI,CAACK,GAAG,CAACC,WAAW,CAAC,CAAC;IAC7C,IAAI,CAACC,QAAQ,CAAC;MAAEC,OAAO,EAAEJ,QAAQ,CAAC,CAAC;IAAE,CAAC,CAAC;IACvC;IACA,MAAMK,SAAS,GAAG,MAAMT,IAAI,CAACK,GAAG,CAACK,GAAG,CAACC,KAAK,CAAC,CAAC;IAC5C,MAAMC,WAAW,GAAGhC,QAAQ,CAACiC,QAAQ,CAACJ,SAAS,CAAC;IAChD,IAAIG,WAAW,EAAE;MACf;MACA,MAAME,QAAQ,GAAG,IAAId,IAAI,CAACK,GAAG,CAACU,QAAQ,CAACnC,QAAQ,CAACoC,GAAG,EAAEJ,WAAW,CAACK,OAAO,CAAC;MACzE,IAAI,CAACV,QAAQ,CAAC;QAAEO;MAAS,CAAC,CAAC;MAC3B;MACA,MAAMI,UAAU,GAAG,MAAMJ,QAAQ,CAACK,OAAO,CAACC,SAAS,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC;MAC5D,IAAI,CAACd,QAAQ,CAAC;QAAEW;MAAW,CAAC,CAAC;MAC7B;MACA,KAAK,IAAII,CAAC,GAAGJ,UAAU,EAAEI,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;QACpC,MAAMC,IAAI,GAAG,MAAMT,QAAQ,CAACK,OAAO,CAACK,KAAK,CAACF,CAAC,CAAC,CAACD,IAAI,CAAC,CAAC;QACnD,IAAI,CAACd,QAAQ,CAAC;UACZiB,KAAK,EAAE,CAAC,GAAG,IAAI,CAACC,KAAK,CAACD,KAAK,EAAED,IAAI;QACnC,CAAC,CAAC;MACJ;IACF,CAAC,MAAM;MACLzB,MAAM,CAACK,KAAK,CAAC,qDAAqD,CAAC;IACrE;EACF;;EAEA;;EA0DAuB,WAAWA,CAACC,KAAK,EAAE;IACjB,KAAK,CAACA,KAAK,CAAC;IAAC,KA1DfC,WAAW,GAAIC,KAAK,IAAK;MACvBA,KAAK,CAACC,cAAc,CAAC,CAAC;MAEtB,MAAMP,IAAI,GAAGM,KAAK,CAACE,MAAM,CAACP,KAAK,CAAC,CAAC,CAAC;MAClC,MAAMQ,MAAM,GAAG,IAAIlC,MAAM,CAACmC,UAAU,CAAC,CAAC;MAEtCD,MAAM,CAACE,iBAAiB,CAACX,IAAI,CAAC;MAC9BS,MAAM,CAACG,SAAS,GAAG,MAAM;QACvB,IAAI,CAAC5B,QAAQ,CAAC;UACZ6B,MAAM,EAAEC,MAAM,CAACL,MAAM,CAACM,MAAM,CAAC;UAC7BC,IAAI,EAAEhB,IAAI,CAACgB,IAAI;UACfC,IAAI,EAAEjB,IAAI,CAACiB;QACb,CAAC,CAAC;QACFC,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAACjB,KAAK,CAACW,MAAM,CAAC;MAC1C,CAAC;IACH,CAAC;IAAA,KAEDO,UAAU,GAAIC,WAAW,IAAK;MAC5BH,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;;MAEzC;MACApD,IAAI,CAACuD,GAAG,CAAC,IAAI,CAACpB,KAAK,CAACW,MAAM,EAAE,CAACU,KAAK,EAAER,MAAM,KAAK;QAC7CG,OAAO,CAACC,GAAG,CAAC,aAAa,EAAEJ,MAAM,CAAC;QAClC,IAAIQ,KAAK,EAAE;UACTL,OAAO,CAACK,KAAK,CAACA,KAAK,CAAC;UACpB;QACF;QAEA,IAAI,CAACvC,QAAQ,CAAC;UAAEwC,OAAO,EAAE;QAAK,CAAC,CAAC;QAChC;QACA,IAAI,IAAI,CAACtB,KAAK,CAACc,IAAI,KAAK,EAAE,EAAE;UAC1B,IAAI,CAAChC,QAAQ,CAAC;YAAEgC,IAAI,EAAE;UAAO,CAAC,CAAC;QACjC;QACA,IAAI,CAACd,KAAK,CAACX,QAAQ,CAACK,OAAO,CACxBwB,UAAU,CACTL,MAAM,CAAC,CAAC,CAAC,CAACU,IAAI,EACdV,MAAM,CAAC,CAAC,CAAC,CAACW,IAAI,EACd,IAAI,CAACxB,KAAK,CAACc,IAAI,EACf,IAAI,CAACd,KAAK,CAACe,IAAI,EACfI,WACF,CAAC,CACAM,IAAI,CAAC;UAAEC,IAAI,EAAE,IAAI,CAAC1B,KAAK,CAACjB;QAAQ,CAAC,CAAC,CAClC4C,EAAE,CAAC,iBAAiB,EAAGJ,IAAI,IAAK;UAC/B,IAAI,CAACzC,QAAQ,CAAC;YACZwC,OAAO,EAAE,KAAK;YACdR,IAAI,EAAE,IAAI;YACVC,IAAI,EAAE;UACR,CAAC,CAAC;UACF1C,MAAM,CAACuD,QAAQ,CAACC,MAAM,CAAC,CAAC;QAC1B,CAAC,CAAC,CACDF,EAAE,CAAC,OAAO,EAAGG,CAAC,IAAK;UAClBzD,MAAM,CAACK,KAAK,CAAC,OAAO,CAAC;UACrB,IAAI,CAACI,QAAQ,CAAC;YAAEwC,OAAO,EAAE;UAAM,CAAC,CAAC;QACnC,CAAC,CAAC;MACN,CAAC,CAAC;IACJ,CAAC;IAIC,IAAI,CAACtB,KAAK,GAAG;MACXjB,OAAO,EAAE,EAAE;MACXM,QAAQ,EAAE,IAAI;MACdU,KAAK,EAAE,EAAE;MACTuB,OAAO,EAAE,KAAK;MACdR,IAAI,EAAE,IAAI;MACVC,IAAI,EAAE;IACR,CAAC;IACD,IAAI,CAACG,UAAU,GAAG,IAAI,CAACA,UAAU,CAACa,IAAI,CAAC,IAAI,CAAC;IAC5C,IAAI,CAAC5B,WAAW,GAAG,IAAI,CAACA,WAAW,CAAC4B,IAAI,CAAC,IAAI,CAAC;EAChD;EAEAC,MAAMA,CAAA,EAAG;IACP,oBACEtE,OAAA;MAAAuE,QAAA,gBACEvE,OAAA,CAACF,UAAU;QAACuB,OAAO,EAAE,IAAI,CAACiB,KAAK,CAACjB;MAAQ;QAAAmD,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,EAC1C,IAAI,CAACrC,KAAK,CAACsB,OAAO,gBACjB5D,OAAA;QAAK4E,EAAE,EAAC,QAAQ;QAACC,SAAS,EAAC,kBAAkB;QAAAN,QAAA,eAC3CvE,OAAA;UAAAuE,QAAA,EAAG;QAAU;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACd,CAAC,gBAEN3E,OAAA,CAACJ,IAAI;QACHyC,KAAK,EAAE,IAAI,CAACC,KAAK,CAACD,KAAM;QACxBI,WAAW,EAAE,IAAI,CAACA,WAAY;QAC9Be,UAAU,EAAE,IAAI,CAACA;MAAW;QAAAgB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC7B,CACF;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC;EAEV;AACF;AAEA,eAAepE,IAAI"},"metadata":{},"sourceType":"module"}