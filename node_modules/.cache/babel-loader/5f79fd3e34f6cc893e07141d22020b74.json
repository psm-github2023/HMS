{"ast":null,"code":"'use strict';\n\nconst promisify = require('promisify-es6');\nconst {\n  URL\n} = require('iso-url');\nconst {\n  getRequest\n} = require('iso-stream-http');\nconst SendOneFile = require('../utils/send-one-file-multiple-results');\nconst FileResultStreamConverter = require('../utils/file-result-stream-converter');\nmodule.exports = send => {\n  const sendOneFile = SendOneFile(send, 'add');\n  return promisify((url, opts, callback) => {\n    if (typeof opts === 'function' && callback === undefined) {\n      callback = opts;\n      opts = {};\n    }\n\n    // opts is the real callback --\n    // 'callback' is being injected by promisify\n    if (typeof opts === 'function' && typeof callback === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    if (!validUrl(url)) {\n      return callback(new Error('\"url\" param must be an http(s) url'));\n    }\n    requestWithRedirect(url, opts, sendOneFile, callback);\n  });\n};\nconst validUrl = url => typeof url === 'string' && url.startsWith('http');\nconst requestWithRedirect = (url, opts, sendOneFile, callback) => {\n  const parsedUrl = new URL(url);\n  const req = getRequest(parsedUrl, res => {\n    if (res.statusCode >= 400) {\n      return callback(new Error(`Failed to download with ${res.statusCode}`));\n    }\n    const redirection = res.headers.location;\n    if (res.statusCode >= 300 && res.statusCode < 400 && redirection) {\n      if (!validUrl(redirection)) {\n        return callback(new Error('redirection url must be an http(s) url'));\n      }\n      requestWithRedirect(redirection, opts, sendOneFile, callback);\n    } else {\n      const requestOpts = {\n        qs: opts,\n        converter: FileResultStreamConverter\n      };\n      const fileName = decodeURIComponent(parsedUrl.pathname.split('/').pop());\n      sendOneFile({\n        content: res,\n        path: fileName\n      }, requestOpts, callback);\n    }\n  });\n  req.once('error', callback);\n  req.end();\n};","map":{"version":3,"names":["promisify","require","URL","getRequest","SendOneFile","FileResultStreamConverter","module","exports","send","sendOneFile","url","opts","callback","undefined","validUrl","Error","requestWithRedirect","startsWith","parsedUrl","req","res","statusCode","redirection","headers","location","requestOpts","qs","converter","fileName","decodeURIComponent","pathname","split","pop","content","path","once","end"],"sources":["C:/blockchain/Victus-health-assistant-main/Victus-health-assistant-main/node_modules/ipfs-http-client/src/files-regular/add-from-url.js"],"sourcesContent":["'use strict'\n\nconst promisify = require('promisify-es6')\nconst { URL } = require('iso-url')\nconst { getRequest } = require('iso-stream-http')\nconst SendOneFile = require('../utils/send-one-file-multiple-results')\nconst FileResultStreamConverter = require('../utils/file-result-stream-converter')\n\nmodule.exports = (send) => {\n  const sendOneFile = SendOneFile(send, 'add')\n\n  return promisify((url, opts, callback) => {\n    if (typeof (opts) === 'function' &&\n        callback === undefined) {\n      callback = opts\n      opts = {}\n    }\n\n    // opts is the real callback --\n    // 'callback' is being injected by promisify\n    if (typeof opts === 'function' &&\n        typeof callback === 'function') {\n      callback = opts\n      opts = {}\n    }\n\n    if (!validUrl(url)) {\n      return callback(new Error('\"url\" param must be an http(s) url'))\n    }\n\n    requestWithRedirect(url, opts, sendOneFile, callback)\n  })\n}\n\nconst validUrl = (url) => typeof url === 'string' && url.startsWith('http')\n\nconst requestWithRedirect = (url, opts, sendOneFile, callback) => {\n  const parsedUrl = new URL(url)\n\n  const req = getRequest(parsedUrl, (res) => {\n    if (res.statusCode >= 400) {\n      return callback(new Error(`Failed to download with ${res.statusCode}`))\n    }\n\n    const redirection = res.headers.location\n\n    if (res.statusCode >= 300 && res.statusCode < 400 && redirection) {\n      if (!validUrl(redirection)) {\n        return callback(new Error('redirection url must be an http(s) url'))\n      }\n\n      requestWithRedirect(redirection, opts, sendOneFile, callback)\n    } else {\n      const requestOpts = {\n        qs: opts,\n        converter: FileResultStreamConverter\n      }\n      const fileName = decodeURIComponent(parsedUrl.pathname.split('/').pop())\n\n      sendOneFile({\n        content: res,\n        path: fileName\n      }, requestOpts, callback)\n    }\n  })\n\n  req.once('error', callback)\n\n  req.end()\n}\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,SAAS,GAAGC,OAAO,CAAC,eAAe,CAAC;AAC1C,MAAM;EAAEC;AAAI,CAAC,GAAGD,OAAO,CAAC,SAAS,CAAC;AAClC,MAAM;EAAEE;AAAW,CAAC,GAAGF,OAAO,CAAC,iBAAiB,CAAC;AACjD,MAAMG,WAAW,GAAGH,OAAO,CAAC,yCAAyC,CAAC;AACtE,MAAMI,yBAAyB,GAAGJ,OAAO,CAAC,uCAAuC,CAAC;AAElFK,MAAM,CAACC,OAAO,GAAIC,IAAI,IAAK;EACzB,MAAMC,WAAW,GAAGL,WAAW,CAACI,IAAI,EAAE,KAAK,CAAC;EAE5C,OAAOR,SAAS,CAAC,CAACU,GAAG,EAAEC,IAAI,EAAEC,QAAQ,KAAK;IACxC,IAAI,OAAQD,IAAK,KAAK,UAAU,IAC5BC,QAAQ,KAAKC,SAAS,EAAE;MAC1BD,QAAQ,GAAGD,IAAI;MACfA,IAAI,GAAG,CAAC,CAAC;IACX;;IAEA;IACA;IACA,IAAI,OAAOA,IAAI,KAAK,UAAU,IAC1B,OAAOC,QAAQ,KAAK,UAAU,EAAE;MAClCA,QAAQ,GAAGD,IAAI;MACfA,IAAI,GAAG,CAAC,CAAC;IACX;IAEA,IAAI,CAACG,QAAQ,CAACJ,GAAG,CAAC,EAAE;MAClB,OAAOE,QAAQ,CAAC,IAAIG,KAAK,CAAC,oCAAoC,CAAC,CAAC;IAClE;IAEAC,mBAAmB,CAACN,GAAG,EAAEC,IAAI,EAAEF,WAAW,EAAEG,QAAQ,CAAC;EACvD,CAAC,CAAC;AACJ,CAAC;AAED,MAAME,QAAQ,GAAIJ,GAAG,IAAK,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,CAACO,UAAU,CAAC,MAAM,CAAC;AAE3E,MAAMD,mBAAmB,GAAGA,CAACN,GAAG,EAAEC,IAAI,EAAEF,WAAW,EAAEG,QAAQ,KAAK;EAChE,MAAMM,SAAS,GAAG,IAAIhB,GAAG,CAACQ,GAAG,CAAC;EAE9B,MAAMS,GAAG,GAAGhB,UAAU,CAACe,SAAS,EAAGE,GAAG,IAAK;IACzC,IAAIA,GAAG,CAACC,UAAU,IAAI,GAAG,EAAE;MACzB,OAAOT,QAAQ,CAAC,IAAIG,KAAK,CAAE,2BAA0BK,GAAG,CAACC,UAAW,EAAC,CAAC,CAAC;IACzE;IAEA,MAAMC,WAAW,GAAGF,GAAG,CAACG,OAAO,CAACC,QAAQ;IAExC,IAAIJ,GAAG,CAACC,UAAU,IAAI,GAAG,IAAID,GAAG,CAACC,UAAU,GAAG,GAAG,IAAIC,WAAW,EAAE;MAChE,IAAI,CAACR,QAAQ,CAACQ,WAAW,CAAC,EAAE;QAC1B,OAAOV,QAAQ,CAAC,IAAIG,KAAK,CAAC,wCAAwC,CAAC,CAAC;MACtE;MAEAC,mBAAmB,CAACM,WAAW,EAAEX,IAAI,EAAEF,WAAW,EAAEG,QAAQ,CAAC;IAC/D,CAAC,MAAM;MACL,MAAMa,WAAW,GAAG;QAClBC,EAAE,EAAEf,IAAI;QACRgB,SAAS,EAAEtB;MACb,CAAC;MACD,MAAMuB,QAAQ,GAAGC,kBAAkB,CAACX,SAAS,CAACY,QAAQ,CAACC,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC,CAAC;MAExEvB,WAAW,CAAC;QACVwB,OAAO,EAAEb,GAAG;QACZc,IAAI,EAAEN;MACR,CAAC,EAAEH,WAAW,EAAEb,QAAQ,CAAC;IAC3B;EACF,CAAC,CAAC;EAEFO,GAAG,CAACgB,IAAI,CAAC,OAAO,EAAEvB,QAAQ,CAAC;EAE3BO,GAAG,CAACiB,GAAG,CAAC,CAAC;AACX,CAAC"},"metadata":{},"sourceType":"script"}